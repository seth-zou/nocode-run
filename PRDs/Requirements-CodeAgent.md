# 应用代码自动生成模块（CodeAgent）的需求分析与详细设计

## 功能描述
1. 通过用户提交的自然语言，描述对生成代码的需求，系统自动生成代码。
    1. 在应用开发页面，用户在需求输入框中输入提示词，点击“生成代码”按钮，执行以下逻辑：
        1. 调用 LLM 模型，根据用户的提示词，生成一个符合要求的代码的文件目录结构。以 Markdown 树形结构输出到左侧面板的代码生成信息展示区域。
        2. 调用 LLM 模型，根据用户的提示词，生成所有代码文件的代码。  以 Markdown 代码块的形式输出到右侧面板的代码展示区域。
        3. 调用 LLM 模型，根据用户的提示词，生成代码的 .env 文件。  以 Markdown 代码块的形式输出到右侧面板的代码展示区域。
        4. 调用 LLM 模型，根据用户的提示词，生成代码的 package.json 文件。  以 Markdown 代码块的形式输出到右侧面板的代码展示区域。
        5. 调用 LLM 模型，根据用户的提示词，生成代码的 README.md 文件。  以 Markdown 代码块的形式输出到右侧面板的代码展示区域。
        6. 调用 LLM 模型，根据用户的提示词，生成代码的 .gitignore 文件。  以 Markdown 代码块的形式输出到右侧面板的代码展示区域。
2. 为每个应用生成的代码都放在服务器的某个目录下，目录的路径和规则可以是：/code/{app_id}/code/。
   1. 其中，{app_id} 是每个应用的唯一标识符，系统在创建应用时会自动生成。
   2. 每个目录下，可以进一步得根据模块，再创建子目录。但是在该子目录下必须有一个 README.md 文件，用于描述该应用系统的一些必要说明。
   3. 如果生成的应用系统包含前端，请在 /code/{app_id}/code/ 下创建子目录 frontend/，用于存放前端代码，并在 frontend 目录下包含 index.html 文件作为入口。
   4. 如果生成的应用系统包含后端，请在 /code/{app_id}/code/ 下创建子目录 backend/，用于存放后端代码。后端代码也可以分更多的模块，每个模块可以在 backend 目录下创建一个对应的子目录。
   5. 每个应用系统的代码，都必须包含一个 README.md 文件，用于描述该应用系统的一些必要说明。
   6. 每个应用系统的代码，都必须包含一个 .gitignore 文件。
   7. 每个应用系统的代码，都必须包含一个 package.json 文件，作为目标应用系统的根配置文件。
  10. 每个应用系统的代码，都必须包含一个 .env 文件，用于存放应用系统的环境变量。
  11. 每个应用系统的代码，都必须包含一个 Dockerfile 文件，用于构建应用系统的 Docker 镜像。
  12. 系统会自动在目标应用系统的目录下，创建一个 .env 文件，用于存放应用系统的环境变量。

3. 关于应用系统的目标预览与调试：
   1. 本系统除了帮助应用系统的代码自动生成之外，还需要将生成得代码部署到某个沙箱环境中，用于预览与调试。
   2. 用户可以在代码生成之后，在本系统应用开发页面的右侧预览页面，可以直接嵌入（比如以IFrame的形式）被生成的应用系统的前端。
   3. 被生成的应用系统，在代码生成之后，可以直接在本系统的沙箱环境中运行，用户可以在本系统的沙箱环境中，直接调试被生成的应用系统的代码。


## 实现方案
1. 基于沙县环境的调试和预览
   1. 沙箱环境，就是一个 docker.1ms.run/library/node:latest 容器镜像。
   2. 沙箱环境，与目标应用系统的代码，并不强制耦合。目标应用系统的代码目录（/code/{app_id}/code/）会按需挂在到沙箱容器中，并指定挂载点为 /code/，这样沙箱环境就可以直接访问到目标应用系统的代码。
   3. 沙箱环境，在启动时，会自动执行目标应用系统的代码。
   4. 沙箱环境，在运行时，会自动监听目标应用系统的代码变化。如果目标应用系统的代码发生变化，沙箱环境会自动重新执行目标应用系统的代码。
   5. 沙箱环境，在运行时，会自动监听目标应用系统的环境变量变化。如果目标应用系统的环境变量发生变化，沙箱环境会自动重新执行目标应用系统的代码。
   6. 沙箱环境，需要默认将前端代码的入口文件，设置为 /code/frontend/index.html，这样在本系统预览页面就可以随时展示目标系统。

2. 代码生成
    1. 首先，在代码生成是一个典型的 Agent，我们计划采用 LangGraph 框架。
    2. 根据用户提示词，调用 LLM 模型，首先需要根据用户的提示词，生成一个符合要求的代码目录结构。
    3. 调用 LLM 模型，根据用户的提示词，生成代码。
    4. 调用 LLM 模型，根据用户的提示词，生成代码的注释。
    4. 调用 LLM 模型，根据用户的提示词，生成代码的配置文件。
    5. 调用 LLM 模型，根据用户的提示词，生成代码的 Dockerfile 文件。
    6. 调用 LLM 模型，根据用户的提示词，生成代码的 .env 文件。
    7. 调用 LLM 模型，根据用户的提示词，生成代码的 package.json 文件。
    8. 调用 LLM 模型，根据用户的提示词，生成代码的 README.md 文件。
    9. 调用 LLM 模型，根据用户的提示词，生成代码的 .gitignore 文件。
    10. 调用 LLM 模型，根据用户的提示词，生成代码的 .env 文件。
    11. 调用 LLM 模型，根据用户的提示词，生成代码的 Dockerfile 文件。
    12. 调用 LLM 模型，根据用户的提示词，生成代码的 package.json 文件。